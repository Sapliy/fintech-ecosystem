.PHONY: build up down logs cli clean test

# Build all service binaries locally
build:
	go build -o bin/auth ./cmd/auth
	go build -o bin/payments ./cmd/payments
	go build -o bin/ledger ./cmd/ledger
	go build -o bin/gateway ./cmd/gateway
	go build -o bin/micro ./cmd/cli

# Start the entire stack in Docker
up:
	docker-compose up --build -d

# Stop the stack and remove volumes
down:
	docker-compose down -v

# View logs for all services
logs:
	docker-compose logs -f

# Run the CLI tool (once built)
cli:
	./bin/micro --help

# Clean up binaries and temporary files
clean:
	rm -rf bin/
	rm -f micro gateway payments auth ledger
	rm -f mock_webhook_server.go

# Run all tests
test:
	go test ./...
